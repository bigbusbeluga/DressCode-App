{% extends 'main.html' %}
{% load static %}
{% block title %}
Mix & Match - DressCode
{% endblock %}
{% block navbar %}
<!-- Override navbar block with nothing -->
{% endblock %}

{% block content %}
{% include 'sidebar.html' %}

    <main class="p-4 sm:ml-64 mt-8">
        <h2 class="text-4xl font-bold mb-4 text-gray-800 pl-4">Outfit Canvas</h2>
        <!-- Flex container for the two sections -->
        <div class="flex gap-4">
            <!-- Outfit Canvas -->
            <section class="w-1/3 bg-white rounded-2xl p-4 flex flex-col items-center shadow-md border">
                <div id="outfit-canvas" class="w-96 h-[500px] border-2 border-dashed border-red-300 rounded-xl p-4 flex flex-wrap justify-center items-center gap-4 bg-[#fefefe] shadow-md">
                    <!-- Dynamically added clothes will appear here -->
                </div>
                <button class="mt-4 bg-pink-300 text-black rounded-full px-6 py-2 font-semibold">Save Outfit</button>
            </section>

            <!-- Clothes Collection -->
            <section class="border flex-1 bg-[#e9f4ff] rounded-2xl p-4 overflow-y-auto shadow-md">
                <div class="flex justify-between mb-4">
                    <div id="filter-buttons" class="flex gap-2 overflow-x-auto whitespace-nowrap">
                        <button class="filter-btn rounded-full px-4 py-1 border font-bold bg-blue-200 text-blue-900" data-filter="ALL">ALL</button>
                        <button class="filter-btn rounded-full px-4 py-1 border font-bold" data-filter="Tops">Outfits</button>
                        <button class="filter-btn rounded-full px-4 py-1 border font-bold" data-filter="Tops">Tops</button>
                        <button class="filter-btn rounded-full px-4 py-1 border font-bold" data-filter="Bottoms">Bottoms</button>
                        <button class="filter-btn rounded-full px-4 py-1 border font-bold" data-filter="Footwear">Footwear</button>
                        <button class="filter-btn rounded-full px-4 py-1 border font-bold" data-filter="Accessories">Hats</button>
                        <button class="filter-btn rounded-full px-4 py-1 border font-bold" data-filter="Accessories">Accessories</button>
                    </div>
                    <a href="{% url 'add-Clothing' %}" class="bg-pink-300 px-4 py-1 rounded-md">Upload</a>
                </div>

                <!-- Search bar || ung filter function kau na lang mag define hahahah-->
                <div class="mb-4 relative">
                    <span class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-2xl pointer-events-none">search</span>
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="Search"
                        class="w-full pl-10 pr-4 py-2 border border-gray-700 rounded-lg"
                        onkeyup="filterClothes()"
                    />
                </div>
                <div class="grid grid-cols-4 gap-4">
                    {% for item in clothing %}
                    <div class="bg-white p-2 rounded-xl shadow flex flex-col items-center"
                         data-image-url="{{ item.image.url }}">
                        <img src="{{ item.image.url }}" alt="Clothing" class="h-28 object-contain">
                        <button onclick="addToCanvas('{{ item.image.url }}')" class="mt-2 text-[12px] bg-white border border-black px-2 py-1 rounded-md">Add</button>
                    </div>
                    {% endfor %}
                </div>
            </section>
        </div>
    </main>
    <script>
        function addToCanvas(imageUrl) {
            // para ma-hide sa collection ung item na na-add sa canvas
            const collectionItem = document.querySelector(`[data-image-url="${imageUrl}"]`);
            if (collectionItem) {
                collectionItem.style.display = 'none';
            }

            // container for the image and delete button
            const container = document.createElement('div');
            container.className = 'relative inline-block m-2';

            // para ma-create image sa canvas
            const img = document.createElement('img');
            img.src = imageUrl;
            img.className = 'h-24';

            // create delete button
            const btn = document.createElement('button');
            btn.innerHTML = '<span class="material-symbols-rounded text-xs text-red-400">close</span>';
            btn.type = 'button';
            btn.className = 'absolute top-0 right-0 bg-white rounded-full w-7 h-7 shadow hover:bg-red-100 p-0.5';
            btn.onclick = function() {
                container.remove();
                // para ma-show ulit ung item sa collection
                if (collectionItem) {
                    collectionItem.style.display = '';
                }
            };

            // append image and button sa container
            container.appendChild(img);
            container.appendChild(btn);

            // add container sa canvas
            document.getElementById('outfit-canvas').appendChild(container);
        }

        // Ito ung script para ma-highlight ung selected filter
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => {
                    b.classList.remove('bg-blue-700', 'text-white', 'bg-blue-200', 'text-blue-900');
                    b.classList.add('text-black');
                });
                this.classList.remove('text-black');
                this.classList.add('bg-blue-700', 'text-white');
                // Optionally, call filter function here
                // filterClothes(this.dataset.filter);
            });
        });
        // Set initial state for "ALL"
        document.querySelector('.filter-btn[data-filter="ALL"]').classList.remove('bg-white', 'text-black');
        document.querySelector('.filter-btn[data-filter="ALL"]').classList.add('bg-blue-700', 'text-white');
    </script>
{% endblock %}
